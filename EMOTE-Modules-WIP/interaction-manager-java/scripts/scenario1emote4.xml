<dialogueScript>
    <!--  <dialoguePolicy/> -->
	<dialogueState>
		<var name="fromModule" type="symbolic" range="user,stm,affect,tts,null"/>
		<var name="empathicTutor" type="boolean" value="false"/>
		<var name="notFirstSession" type="boolean" value="false"/>
		<var name="scenarioName" type="string" value="null" copyToOutput="true"/>
		<var name="interactionStatus" type="symbolic" value="stopped" range="started,stopped"/>
		
		<var name="userCommunicativeFunction" type="symbolic" />
		<var name="systemCommunicativeFunction" type="symbolic" />
		
		<!--  use copyToOutput=true to copy variable from dstate into output da without having to spcecify them in each action -->
		<var name="learnerId" type="string" copyToOutput="true"/>
		<var name="learnerName" type="string" copyToOutput="true"/>
		<var name="learnerGender" type="string" copyToOutput="true"/>
		
		<var name="lastUtteranceId" type="string" value="null"/>
		
		<var name="lastSessionSkill" type="string" value="null"/>
		
		<var name="firstStep" type="boolean" value="true" />
		<var name="currentStepId" type="string" />
		<var name="currentStepSpeech" type="string" />
		<var name="currentStepTimeOut" type="number" value="10"/>
		<var name="currentStepTimeOutCount" type="number" value="0"/>
		<var name="globalStepTimeOutCount" type="number" value="0"/>
		
		<var name="currentStepAnswerAttemptCount" type="number" value="0"/>
		<var name="userResponseTimedOut" type="boolean" />
		
		<var name="introEpisodeState" type="symbolic" value="greet" range="greet,askReady,taskIntro,recap,done" />
		<var name="opEpisodeState" type="symbolic" value="null" range="start,intro,tech,task,done" />
		<var name="closingEpisodeState" type="symbolic" value="null" range="outro,recap,bye,done" />
		
		<var name="taskLinked" type="boolean" />
		
		<var name="toolSkillRequired" type="boolean" />
		<var name="directionSkillRequired" type="boolean" />
		<var name="distanceSkillRequired" type="boolean" />
		<var name="symbolSkillRequired" type="boolean" />
		<var name="bestSkillSoFar" type="symbolic" range="distance,direction,symbol"/>
		<var name="directionSkillLevel" type="symbolic" range="low,medium,high" value="medium"/>
		<var name="distanceSkillLevel" type="symbolic" range="low,medium,high" value="medium"/>
		<var name="symbolSkillLevel" type="symbolic" range="low,medium,high" value="medium"/>
		<var name="overallSkillLevel" type="symbolic" range="low,medium,high" value="medium"/>
		<var name="toolSkillRequired" type="boolean" />
		<var name="correctDirection" type="string" copyToOutput="true"/>
		<var name="correctDistance" type="number" copyToOutput="true"/>
		<var name="distanceMetric" type="symbolic" range="m,km" copyToOutput="true"/>
		<var name="correctSymbol" type="string" value="starting point" copyToOutput="true"/>
		<var name="correctTool" type="string"/>
		<var name="previousSymbol" type="string" value="starting point" copyToOutput="true"/>
		<var name="infoOnCompletion" type="boolean" />
		<var name="clueSpeech" type="boolean" value="false"/>
		<var name="objectPlacementTask" type="boolean" />
		<var name="clueNumber" type="number" value="0" />
		
		<var name="dirToolUsed" type="boolean" />
		<var name="disToolUsed" type="boolean" />
		<var name="symToolUsed" type="boolean" />
		<var name="dirToolUsedCount" type="number" value="0" />
		<var name="disToolUsedCount" type="number" value="0" />
		<var name="symToolUsedCount" type="number" value="0" />
		<var name="responseCorrect" type="boolean" />
		<var name="responseRequired" type="boolean" value="false"/>
		<var name="responseSkillsCorrectCount" type="number" value="0"/>
		<var name="responseIncorrectCount" type="number" value="0"/>
		<var name="responseCorrectInARowCount" type="number" value="0"/>
		<var name="directionCorrect" type="boolean" />
		<var name="distanceCorrect" type="boolean" />
		<var name="symbolCorrect" type="boolean" />
		<var name="toolCorrect" type="boolean" />
		
		<var name="cftried:elaboration:direction" type="boolean" />
		<var name="cftried:elaboration:distance" type="boolean" />
		<var name="cftried:elaboration:symbol" type="boolean" />
		<var name="cftried:pump:tool:direction" type="boolean" />
		<var name="cftried:pump:tool:distance" type="boolean" />
		<var name="cftried:pump:tool:symbol" type="boolean" />
		<var name="cftried:pump:direction" type="boolean" />
		<var name="cftried:hint:direction" type="boolean" />
		<var name="cftried:focus:direction" type="boolean" />
		<var name="cftried:pump:distance" type="boolean" />
		<var name="cftried:hint:distance" type="boolean" />
		<var name="cftried:focus:distance" type="boolean" />
		<var name="cftried:pump:symbol" type="boolean" />
		<var name="cftried:hint:symbol" type="boolean" />
		<var name="cftried:focus:symbol" type="boolean" />
		<var name="cftried:rebound" type="boolean" />
		<var name="cftried:tellAJoke" type="boolean" />
		<var name="cftried:objectPlacement:rebound" type="boolean" value="false" />
		
		<var name="answeredDistance" type="number" value="0"/>
		<var name="answeredDirection" type="string" />
		<var name="answeredSymbol" type="string" />
		<var name="answeredTool" type="string" />
		
		<var name="valence" type="symbolic" range="positive,negative"/>
	    <var name="arousal" type="symbolic" range="positive,negative"/>
		<var name="engaged" type="boolean" />
		<var name="engagedTo" type="symbolic" range="task,robot"/>
		<var name="sensedUserAffect" type="symbolic" range="happy,calm,bored,frustrated,neutral" value="neutral"/>
		<var name="sensedAffectConf" type="number" value="0"/>
		<var name="sensedAffectConfThreshold" type="number" value="400"/>
		
		<var name="inferredUserAffect" type="symbolic" range="happy,calm,bored,frustrated,neutral" value="neutral"/>
		<var name="useInferredAffect" type="string" value="combine" range="no,always,combine"/>
		
		<var name="userAffect" type="symbolic" range="happy,calm,bored,frustrated,neutral" value="neutral"/>
		
		
		<var name="taskStatus" type="symbolic" value="closed" range="closed,task-requested,task-acquired,ongoing"/>
		<var name="activityEnded" type="boolean" value="false"/>
		<var name="currentUtterance" type="string" value="null"/>
		<var name="utteranceStatus" type="symbolic" value="delivered" range="delivered,sent-to-tts,playing"/>
	</dialogueState>
	<input>
	    <var name="fromModule" type="symbolic" value="null"/>
	</input>
	<input module="hub">
	    <var name="time-out" type="boolean" />
	</input>
	<input module="affect">
	    <var name="valence" type="symbolic" range="positive,negative"/>
	    <var name="arousal" type="symbolic" range="positive,negative"/>
	    <var name="confidence" type="number" />
	</input>
	<input module="tts">
	    <var name="utteranceStatus" type="symbolic" range="playing,delivered"/>
	    <var name="utteranceId" type="string"/>
	</input>
	<input module="map">
	    <var name="disToolUsed" type="boolean" />
	    <var name="dirToolUsed" type="boolean" />
	    <var name="symToolUsed" type="boolean" />
	</input>
	<input module="user">
	    <var name="communicativeFunction" type="symbolic" />
	    <var name="responseCorrect" type="boolean" />
	    <var name="directionCorrect" type="boolean" />
	    <var name="distanceCorrect" type="boolean" />
	    <var name="symbolCorrect" type="boolean" />
	    <var name="bestSkillSoFar" type="symbolic" />
	    <var name="directionSkillLevel" type="symbolic" />
	    <var name="distanceSkillLevel" type="symbolic" />
	    <var name="symbolSkillLevel" type="symbolic" />
	    <var name="overallSkillLevel" type="symbolic" />
	    <var name="actualSymbol" type="string" />
	    <var name="actualDirection" type="string" />
	    <var name="actualDistance" type="number" />
	    <var name="actualTool" type="number" />
	    <var name="currentStepId" type="string" />
	    <var name="disToolUsed" type="boolean" />
	    <var name="dirToolUsed" type="boolean" />
	    <var name="symToolUsed" type="boolean" />
	</input>
	<input module="stm">
		<var name="scenario-name" type="string" />
	    <var name="stepId" type="string" />
	    <var name="direction" type="boolean" />
		<var name="distance" type="boolean" />
		<var name="symbol" type="boolean" />
		<var name="tool" type="string" />
		<var name="direction-required" type="string" />
		<var name="distance-required" type="number" />
		<var name="symbol-name-required" type="string" />
		<var name="distance-metric" type="symbolic" />
		<var name="tool-required" type="string" />
		<var name="step-speech" type="string" />
		<var name="time-out" type="number" />
		<var name="info-on-completion" type="boolean" />
		<var name="objectPlacementTask" type="boolean" />
	</input>
	<metric>
	    <var name="turns" type="number" value="0" />
	    <var name="directionPumpCount" type="number" value="0" />
	    <var name="distancePumpCount" type="number" value="0" />
	    <var name="symbolPumpCount" type="number" value="0" />
	</metric>
	<!-- STATE UPDATE RULES -->
	
	<stateUpdateRules>
		<rule comment="reset from module">
			<precondition/>
			<action>
			     <assign>
					<assignee var="fromModule" domain="dstate" />
					<assigner value="null" />
				</assign>
			</action>
		</rule>
	    <rule comment="copy input variable from map">
			<precondition>
				<equals>
				    <op1 var="fromModule" domain="input"/>
				    <op2 value="map"/>
				</equals>    
			</precondition>
			<action>
			     <assign>
					<assignee var="fromModule" domain="dstate" />
					<assigner var="fromModule" domain="input" />
				</assign>
				<assign>
					<assignee var="dirToolUsed" domain="dstate" />
					<assigner var="dirToolUsed" domain="input" />
				</assign>
				<assign>
					<assignee var="disToolUsed" domain="dstate" />
					<assigner var="disToolUsed" domain="input" />
				</assign>
				<assign>
					<assignee var="symToolUsed" domain="dstate" />
					<assigner var="symToolUsed" domain="input" />
				</assign>
			</action>
		</rule>
		<rule comment="copy input variable from user">
			<precondition>
				<equals>
				    <op1 var="fromModule" domain="input"/>
				    <op2 value="user"/>
				</equals>    
			</precondition>
			<action>
			     <assign>
					<assignee var="fromModule" domain="dstate" />
					<assigner var="fromModule" domain="input" />
				</assign>
				<assign>
					<assignee var="fromModule" domain="input" />
					<assigner value="null" />
				</assign>
			    <assign>
					<assignee var="userCommunicativeFunction" domain="dstate" />
					<assigner var="communicativeFunction" domain="input" />
				</assign>
				<assign>
					<assignee var="responseCorrect" domain="dstate" />
					<assigner var="responseCorrect" domain="input" />
				</assign>
				<assign>
					<assignee var="directionCorrect" domain="dstate" />
					<assigner var="directionCorrect" domain="input" />
				</assign>
				<assign>
					<assignee var="symbolCorrect" domain="dstate" />
					<assigner var="symbolCorrect" domain="input" />
				</assign>
				<assign>
					<assignee var="distanceCorrect" domain="dstate" />
					<assigner var="distanceCorrect" domain="input" />
				</assign>
				<assign>
					<assignee var="bestSkillSoFar" domain="dstate" />
					<assigner var="bestSkillSoFar" domain="input" />
				</assign>
				<assign>
					<assignee var="directionSkillLevel" domain="dstate" />
					<assigner var="directionSkillLevel" domain="input" />
				</assign>
				<assign>
					<assignee var="symbolSkillLevel" domain="dstate" />
					<assigner var="symbolSkillLevel" domain="input" />
				</assign>
				<assign>
					<assignee var="distanceSkillLevel" domain="dstate" />
					<assigner var="distanceSkillLevel" domain="input" />
				</assign>
				<assign>
					<assignee var="overallSkillLevel" domain="dstate" />
					<assigner var="overallSkillLevel" domain="input" />
				</assign>
				<assign>
					<assignee var="toolCorrect" domain="dstate" />
					<assigner var="toolCorrect" domain="input" />
				</assign>
				<assign>
					<assignee var="answeredSymbol" domain="dstate" />
					<assigner var="actualSymbol" domain="input" />
				</assign>
				<assign>
					<assignee var="answeredDirection" domain="dstate" />
					<assigner var="actualDirection" domain="input" />
				</assign>
				<assign>
					<assignee var="answeredDistance" domain="dstate" />
					<assigner var="actualDistance" domain="input" />
				</assign>
				<assign>
					<assignee var="answeredTool" domain="dstate" />
					<assigner var="actualTool" domain="input" />
				</assign>
				<assign>
					<assignee var="userResponseTimedOut" domain="dstate" />
					<assigner value="false" />
				</assign>
				<assign>
				    <assignee var="currentStepAnswerAttemptCount" domain="dstate" />
					<assigner>
							<add>
								<op1 var="currentStepAnswerAttemptCount" domain="dstate" />
								<op2 value="1.0" />
							</add>
					</assigner>
				</assign>
				<assign>
				    <assignee var="responseSkillsCorrectCount" domain="dstate" />
					<assigner value="0.0"/>
				</assign>
				<assign>
	                <assignee var="currentStepTimeOutCount" domain="dstate"/>
					<assigner value="0.0" />
           		</assign>
	        </action>
		</rule>
		
		<rule comment="copy input from hub">
			<precondition>
				<equals>
				    <op1 var="fromModule" domain="input"/>
				    <op2 value="hub" />
				</equals>
			</precondition>
			<action>
			    <assign>
					<assignee var="fromModule" domain="dstate" />
					<assigner var="fromModule" domain="input" />
				</assign>
				<assign>
					<assignee var="fromModule" domain="input" />
					<assigner value="null" />
				</assign>
				
			</action>
		</rule>
		<rule comment="copy input from affect">
			<precondition>
		    	<equals>
				    <op1 var="fromModule" domain="input"/>
				    <op2 value="affect" />
				</equals> 
			</precondition>
			<action>
			    <assign>
					<assignee var="fromModule" domain="dstate" />
					<assigner var="fromModule" domain="input" />
				</assign>
				<assign>
					<assignee var="fromModule" domain="input" />
					<assigner value="null" />
				</assign>
				<assign>
					<assignee var="arousal" domain="dstate" />
					<assigner var="arousal" domain="input"/>
				</assign>
				<assign>
					<assignee var="valence" domain="dstate" />
					<assigner var="valence" domain="input"/>
				</assign>
				<assign>
					<assignee var="sensedAffectConf" domain="dstate" />
					<assigner var="confidence" domain="input"/>
				</assign>
			</action>
		</rule>
		<rule comment="copy input from tts module">
			<precondition>
			    <and>
					<equals>
					    <op1 var="fromModule" domain="input"/>
					    <op2 value="tts" />
					</equals> 
					<equals>
					    <op1 var="utteranceId" domain="input"/>
					    <op2 var="lastUtteranceId" domain="dstate"/>
					</equals> 
				</and>
			</precondition>
			<action>
			    <assign>
					<assignee var="fromModule" domain="dstate" />
					<assigner var="fromModule" domain="input" />
				</assign>
				<assign>
					<assignee var="fromModule" domain="input" />
					<assigner value="null" />
				</assign>
				<assign>
					<assignee var="utteranceStatus" domain="dstate" />
					<assigner var="utteranceStatus" domain="input" />
				</assign>
			</action>
		</rule>
		<rule comment="copying over previous symbol">
	        <precondition>
	            <and>
		            <equals>
						<op1 var="taskStatus"  domain="dstate"/>
						<op2 value="task-requested"/>
					</equals>
					<equals>
					    <op1 var="fromModule" domain="input"/>
					    <op2 value="stm" />
					</equals> 
					<not-equals>
					    <op1 var="correctSymbol" domain="dstate"/>
					    <op2 value="null" />
					</not-equals> 
				</and>
	        </precondition>
	        <action>
	        	<assign>
					<assignee var="previousSymbol" domain="dstate"/>
					<assigner var="correctSymbol" domain="dstate" />
				</assign>
			</action>
	    </rule>
		<rule comment="copying input from stm">
	        <precondition>
	            <and>
		            <equals>
						<op1 var="taskStatus"  domain="dstate"/>
						<op2 value="task-requested"/>
					</equals>
					<equals>
					    <op1 var="fromModule" domain="input"/>
					    <op2 value="stm" />
					</equals> 
				</and>
	        </precondition>
	        <action>
	            <assign>
					<assignee var="fromModule" domain="dstate" />
					<assigner var="fromModule" domain="input" />
				</assign>
				<assign>
					<assignee var="fromModule" domain="input" />
					<assigner value="null" />
				</assign>
	            <assign>
					<assignee var="scenarioName" domain="dstate" />
					<assigner var="scenario-name" domain="input" />
				</assign>
	            <assign>
					<assignee var="currentStepId" domain="dstate" />
					<assigner var="stepId" domain="input" />
				</assign>
				 <assign>
					<assignee var="currentStepTimeOut" domain="dstate" />
					<assigner var="time-out" domain="input" />
				</assign>
				<assign>
					<assignee var="currentStepSpeech" domain="dstate" />
					<assigner var="step-speech" domain="input" />
				</assign>
				<assign>
					<assignee var="directionSkillRequired" domain="dstate" />
					<assigner var="direction" domain="input" />
				</assign>
				<assign>
					<assignee var="distanceSkillRequired" domain="dstate" />
					<assigner var="distance" domain="input" />
				</assign>
				<assign>
					<assignee var="distanceMetric" domain="dstate" />
					<assigner var="distance-metric" domain="input" />
				</assign>
				<assign>
					<assignee var="symbolSkillRequired" domain="dstate"/>
					<assigner var="symbol" domain="input" />
				</assign>
				<assign>
					<assignee var="toolSkillRequired" domain="dstate"/>
					<assigner var="tool-required" domain="input" />
				</assign>
				<assign>
					<assignee var="infoOnCompletion" domain="dstate"/>
					<assigner var="info-on-completion" domain="input" />
				</assign>
				<assign>
					<assignee var="objectPlacementTask" domain="dstate"/>
					<assigner var="objectPlacementTask" domain="input" />
				</assign>
	         	<assign>
	                <assignee var="taskStatus" domain="dstate"/>
					<assigner value="task-acquired" />
	            </assign>
	            <assign>
	                <assignee var="taskLinked" domain="dstate"/>
					<assigner value="false" />
	            </assign>
	            <assign>
					<assignee var="correctDirection" domain="dstate"/>
					<assigner var="direction-required" domain="input" />
				</assign>
				<assign>
					<assignee var="correctDistance" domain="dstate"/>
					<assigner var="distance-required" domain="input" />
				</assign>
				<assign>
					<assignee var="correctSymbol" domain="dstate"/>
					<assigner var="symbol-name-required" domain="input" />
				</assign>
				<assign>
					<assignee var="correctTool" domain="dstate"/>
					<assigner var="tool" domain="input" />
				</assign>
				<assign>
					<assignee var="dirToolUsed" domain="dstate"/>
					<assigner var="dirToolUsed" domain="input" />
				</assign>
				<assign>
					<assignee var="disToolUsed" domain="dstate"/>
					<assigner var="disToolUsed" domain="input" />
				</assign>
				<assign>
					<assignee var="symToolUsed" domain="dstate"/>
					<assigner var="symToolUsed" domain="input" />
				</assign>
				
	            <assign>
				    <assignee var="utteranceStatus" domain="dstate"/>
					<assigner value="delivered" />
				</assign>
				<assign>
				    <assignee var="cftried:pump:tool:direction" domain="dstate"/>
					<assigner value="false" />
				</assign>
				<assign>
				    <assignee var="cftried:pump:tool:distance" domain="dstate"/>
					<assigner value="false" />
				</assign>
				<assign>
				    <assignee var="cftried:pump:tool:symbol" domain="dstate"/>
					<assigner value="false" />
				</assign>
				<assign>
				    <assignee var="cftried:pump:direction" domain="dstate"/>
					<assigner value="false" />
				</assign>
				<assign>
				    <assignee var="cftried:pump:distance" domain="dstate"/>
					<assigner value="false" />
				</assign>
				<assign>
				    <assignee var="cftried:pump:symbol" domain="dstate"/>
					<assigner value="false" />
				</assign>
				<assign>
				    <assignee var="cftried:tellAJoke" domain="dstate"/>
					<assigner value="false" />
				</assign>
				<assign>
				    <assignee var="triedDirectionPump" domain="dstate"/>
					<assigner value="false" />
				</assign>
				<assign>
				    <assignee var="triedDistancePump" domain="dstate"/>
					<assigner value="false" />
				</assign>
				<assign>
				    <assignee var="triedSymbolPump" domain="dstate"/>
					<assigner value="false" />
				</assign>
				<assign>
					<assignee var="directionCorrect" domain="dstate" />
					<assigner value="false" />
				</assign>
				<assign>
					<assignee var="symbolCorrect" domain="dstate" />
					<assigner value="false" />
				</assign>
				<assign>
					<assignee var="distanceCorrect" domain="dstate" />
					<assigner value="false" />
				</assign>
			</action>
	    </rule>
	    
	    <rule comment="is object placement task">
		    <precondition>
		        <and>
			        <equals>
						<op1 var="fromModule"  domain="dstate"/>
						<op2 value="stm"/>
					</equals>
					<equals>
						<op1 var="objectPlacementTask"  domain="dstate"/>
						<op2 value="true"/>
					</equals>
					<equals>
						<op1 var="opEpisodeState"  domain="dstate"/>
						<op2 value="null"/>
					</equals>
				</and>
		    </precondition>
		    <action>
		        <assign>
				    <assignee var="opEpisodeState" domain="dstate" />
					<assigner value="start" />
				</assign>
		    </action>
		</rule>
		<rule comment="count correct answers in a row">
			<precondition>
				<and>
			    	<equals>
						<op1 var="fromModule"  domain="dstate"/>
						<op2 value="user"/>
					</equals>
					<equals>
						<op1 var="responseCorrect"  domain="dstate"/>
						<op2 value="true"/>
					</equals>
				</and>
			</precondition>
			<action>
				<assign>
				    <assignee var="responseCorrectInARowCount" domain="dstate" />
					<assigner>
							<add>
								<op1 var="responseCorrectInARowCount" domain="dstate" />
								<op2 value="1.0" />
							</add>
					</assigner>
				</assign>
			</action>
		</rule>
	    <rule comment="count correct answers per attempt 1">
		    <precondition>
		    	<and>
			    	<equals>
						<op1 var="fromModule"  domain="dstate"/>
						<op2 value="user"/>
					</equals>
			        <equals>
						<op1 var="directionSkillRequired"  domain="dstate"/>
						<op2 value="true"/>
					</equals>
					<equals>
						<op1 var="directionCorrect"  domain="dstate"/>
						<op2 value="true"/>
					</equals>
				</and>
		    </precondition>
		    <action>
		        <assign>
				    <assignee var="responseSkillsCorrectCount" domain="dstate" />
					<assigner>
							<add>
								<op1 var="responseSkillsCorrectCount" domain="dstate" />
								<op2 value="1.0" />
							</add>
					</assigner>
				</assign>
		    </action>
		</rule>
		<rule comment="count correct answers per attempt 2">
		    <precondition>
		    	<and>
			        <equals>
						<op1 var="fromModule"  domain="dstate"/>
						<op2 value="user"/>
					</equals>
			        <equals>
						<op1 var="distanceSkillRequired"  domain="dstate"/>
						<op2 value="true"/>
					</equals>
					<equals>
						<op1 var="distanceCorrect"  domain="dstate"/>
						<op2 value="true"/>
					</equals>
				</and>
		    </precondition>
		    <action>
		        <assign>
				    <assignee var="responseSkillsCorrectCount" domain="dstate" />
					<assigner>
							<add>
								<op1 var="responseSkillsCorrectCount" domain="dstate" />
								<op2 value="1.0" />
							</add>
					</assigner>
				</assign>
		    </action>
		</rule>
		<rule comment="count correct answers per attempt 3">
		    <precondition>
		    	<and>
		    		<equals>
						<op1 var="fromModule"  domain="dstate"/>
						<op2 value="user"/>
					</equals>
			        <equals>
						<op1 var="symbolSkillRequired"  domain="dstate"/>
						<op2 value="true"/>
					</equals>
					<equals>
						<op1 var="symbolCorrect"  domain="dstate"/>
						<op2 value="true"/>
					</equals>
				</and>
		    </precondition>
		    <action>
		        <assign>
				    <assignee var="responseSkillsCorrectCount" domain="dstate" />
					<assigner>
							<add>
								<op1 var="responseSkillsCorrectCount" domain="dstate" />
								<op2 value="1.0" />
							</add>
					</assigner>
				</assign>
		    </action>
		</rule>
		<rule comment="count incorrect answers">
		    <precondition>
		    	<and>
			        <equals>
						<op1 var="responseCorrect"  domain="dstate"/>
						<op2 value="false"/>
					</equals>
					<equals>
					    <op1 var="fromModule" domain="dstate"/>
					    <op2 value="user" />
					</equals>
				</and>
			</precondition>
		    <action>
		    	<assign>
				    <assignee var="responseCorrectInARowCount" domain="dstate" />
					<assigner value="0.0" />
				</assign>
		        <assign>
				    <assignee var="responseIncorrectCount" domain="dstate" />
					<assigner>
							<add>
								<op1 var="responseIncorrectCount" domain="dstate" />
								<op2 value="1.0" />
							</add>
					</assigner>
				</assign>
		    </action>
		</rule>
		<rule comment="count dirTool use">
		    <precondition>
		    	<and>
			        <equals>
						<op1 var="dirToolUsed"  domain="dstate"/>
						<op2 value="true"/>
					</equals>
					<equals>
					    <op1 var="fromModule" domain="dstate"/>
					    <op2 value="map" />
					</equals>
				</and>
			</precondition>
		    <action>
		        <assign>
				    <assignee var="dirToolUsedCount" domain="dstate" />
					<assigner>
							<add>
								<op1 var="dirToolUsedCount" domain="dstate" />
								<op2 value="1.0" />
							</add>
					</assigner>
				</assign>
		    </action>
		</rule>
		<rule comment="count disTool use">
		    <precondition>
		    	<and>
			        <equals>
						<op1 var="disToolUsed"  domain="dstate"/>
						<op2 value="true"/>
					</equals>
					<equals>
					    <op1 var="fromModule" domain="dstate"/>
					    <op2 value="map" />
					</equals>
				</and>
			</precondition>
		    <action>
		        <assign>
				    <assignee var="disToolUsedCount" domain="dstate" />
					<assigner>
							<add>
								<op1 var="disToolUsedCount" domain="dstate" />
								<op2 value="1.0" />
							</add>
					</assigner>
				</assign>
		    </action>
		</rule>
		<rule comment="count symTool use">
		    <precondition>
		    	<and>
			        <equals>
						<op1 var="symToolUsed"  domain="dstate"/>
						<op2 value="true"/>
					</equals>
					<equals>
					    <op1 var="fromModule" domain="dstate"/>
					    <op2 value="map" />
					</equals>
				</and>
			</precondition>
		    <action>
		        <assign>
				    <assignee var="symToolUsedCount" domain="dstate" />
					<assigner>
							<add>
								<op1 var="symToolUsedCount" domain="dstate" />
								<op2 value="1.0" />
							</add>
					</assigner>
				</assign>
		    </action>
		</rule>
		<rule comment="if user is acquainted with dirTool">
		    <precondition>
		        <ge>
					<op1 var="dirToolUsedCount"  domain="dstate"/>
					<op2 value="3.0" type="number"/>
				</ge>
			</precondition>
		    <action>
		        <assign>
				    <assignee var="dirToolUsed" domain="dstate" />
					<assigner value="true" />
				</assign>
		    </action>
		</rule>
		<rule comment="if user is acquainted with disTool">
		    <precondition>
		        <ge>
					<op1 var="disToolUsedCount"  domain="dstate"/>
					<op2 value="3.0" type="number"/>
				</ge>
			</precondition>
		    <action>
		        <assign>
				    <assignee var="disToolUsed" domain="dstate" />
					<assigner value="true" />
				</assign>
		    </action>
		</rule>
		<rule comment="if user is acquainted with symTool">
		    <precondition>
		        <ge>
					<op1 var="symToolUsedCount"  domain="dstate"/>
					<op2 value="3.0" type="number"/>
				</ge>
			</precondition>
		    <action>
		        <assign>
				    <assignee var="symToolUsed" domain="dstate" />
					<assigner value="true" />
				</assign>
		    </action>
		</rule>
		<rule comment="count clueNumber">
		    <precondition>
		    	<and>
			        <equals>
						<op1 var="infoOnCompletion"  domain="dstate"/>
						<op2 value="true"/>
					</equals>
					<equals>
					    <op1 var="fromModule" domain="dstate"/>
					    <op2 value="stm" />
					</equals>
				</and>
			</precondition>
		    <action>
		        <assign>
				    <assignee var="clueNumber" domain="dstate" />
					<assigner>
							<add>
								<op1 var="clueNumber" domain="dstate" />
								<op2 value="1.0" />
							</add>
					</assigner>
				</assign>
		    </action>
		</rule>
		<rule comment="setting taskLinked for firstStep">
			<precondition>
		    	<and>
			        <equals>
						<op1 var="firstStep"  domain="dstate"/>
						<op2 value="true"/>
					</equals>
					<equals>
					    <op1 var="fromModule" domain="dstate"/>
					    <op2 value="stm" />
					</equals>
				</and>
			</precondition>
		    <action>
		        <assign>
				    <assignee var="taskLinked" domain="dstate" />
					<assigner value="true"/>
				</assign>
				<assign>
					<assignee var="firstStep" domain="dstate" />
					<assigner value="false"/>
				</assign>
		    </action>
		</rule>
	    <rule comment="compute the affect state 1">
	        <precondition>
	            <and>
	                <equals>
					    <op1 var="fromModule" domain="dstate"/>
					    <op2 value="affect" />
					</equals>
	                <equals>
						<op1 var="empathicTutor"  domain="dstate"/>
						<op2 value="true"/>
					</equals>
					<equals>
						<op1 var="valence"  domain="dstate"/>
						<op2 value="positive"/>
					</equals>
					<equals>
						<op1 var="arousal"  domain="dstate"/>
						<op2 value="positive"/>
					</equals>
	            </and>
	        </precondition>
	        <action>
	            <assign>
	                <assignee var="sensedUserAffect" domain="dstate"/>
					<assigner value="happy" />
	            </assign>
	        </action>
	    </rule>
	     <rule comment="compute the affect state 2">
	        <precondition>
	            <and>
	            	<equals>
					    <op1 var="fromModule" domain="dstate"/>
					    <op2 value="affect" />
					</equals>
	                <equals>
						<op1 var="empathicTutor"  domain="dstate"/>
						<op2 value="true"/>
					</equals>
	                <equals>
						<op1 var="valence"  domain="dstate"/>
						<op2 value="negative"/>
					</equals>
					<equals>
						<op1 var="arousal"  domain="dstate"/>
						<op2 value="positive"/>
					</equals>
	            </and>
	        </precondition>
	        <action>
	            <assign>
	                <assignee var="sensedUserAffect" domain="dstate"/>
					<assigner value="frustrated" />
	            </assign>
	        </action>
	    </rule>
	     <rule comment="compute the affect state 3">
	        <precondition>
	            <and>
	            	<equals>
					    <op1 var="fromModule" domain="dstate"/>
					    <op2 value="affect" />
					</equals>
	                <equals>
						<op1 var="empathicTutor"  domain="dstate"/>
						<op2 value="true"/>
					</equals>
	                <equals>
						<op1 var="valence"  domain="dstate"/>
						<op2 value="positive"/>
					</equals>
					<equals>
						<op1 var="arousal"  domain="dstate"/>
						<op2 value="negative"/>
					</equals>
	            </and>
	        </precondition>
	        <action>
	            <assign>
	                <assignee var="sensedUserAffect" domain="dstate"/>
					<assigner value="calm" />
	            </assign>
	        </action>
	    </rule>
	     <rule comment="compute the affect state 4">
	        <precondition>
	            <and>
	            	<equals>
					    <op1 var="fromModule" domain="dstate"/>
					    <op2 value="affect" />
					</equals>
	                <equals>
						<op1 var="empathicTutor"  domain="dstate"/>
						<op2 value="true"/>
					</equals>
	                <equals>
						<op1 var="valence"  domain="dstate"/>
						<op2 value="negative"/>
					</equals>
					<equals>
						<op1 var="arousal"  domain="dstate"/>
						<op2 value="negative"/>
					</equals>
	            </and>
	        </precondition>
	        <action>
	            <assign>
	                <assignee var="sensedUserAffect" domain="dstate"/>
					<assigner value="bored" />
	            </assign>
	        </action>
	    </rule>
	    <rule comment="compute the affect state 5">
	        <precondition>
	            <and>
	            	<equals>
					    <op1 var="fromModule" domain="dstate"/>
					    <op2 value="affect" />
					</equals>
	                <equals>
						<op1 var="empathicTutor"  domain="dstate"/>
						<op2 value="true"/>
					</equals>
		            <or>
		                <equals>
							<op1 var="valence"  domain="dstate"/>
							<op2 value="neutral"/>
						</equals>
						<equals>
							<op1 var="arousal"  domain="dstate"/>
							<op2 value="neutral"/>
						</equals>
		            </or>
		        </and>
	        </precondition>
	        <action>
	            <assign>
	                <assignee var="sensedUserAffect" domain="dstate"/>
					<assigner value="neutral" />
	            </assign>
	        </action>
	    </rule>
	    <rule comment="compute the inferred affect state 1 - DEFAULT">
	        <precondition>
        		<equals>
				    <op1 var="fromModule" domain="dstate"/>
				    <op2 value="user" />
				</equals>
	        </precondition>
	        <action>
	            <assign>
	                <assignee var="inferredUserAffect" domain="dstate"/>
					<assigner value="neutral" />
	            </assign>
	        </action>
	    </rule>
	    <rule comment="compute the inferred affect state 2_0">
	        <precondition>
	        	<and>
	        		<equals>
					    <op1 var="fromModule" domain="dstate"/>
					    <op2 value="user" />
					</equals>
					<equals>
						<op1 var="overallSkillLevel" domain="dstate"/>
					    <op2 value="low" />
					</equals>
		            <ge>
		                <op1 var="responseIncorrectCount"  domain="dstate"/>
						<op2 value="3.0" type="number"/>
		            </ge>
		        </and>
	        </precondition>
	        <action>
	            <assign>
	                <assignee var="inferredUserAffect" domain="dstate"/>
					<assigner value="frustrated" />
	            </assign>
	        </action>
	    </rule>
	    <rule comment="compute the inferred affect state 2_1">
	        <precondition>
	        	<and>
	        		<equals>
					    <op1 var="fromModule" domain="dstate"/>
					    <op2 value="user" />
					</equals>
					<equals>
						<op1 var="overallSkillLevel" domain="dstate"/>
					    <op2 value="medium" />
					</equals>
		            <ge>
		                <op1 var="responseIncorrectCount"  domain="dstate"/>
						<op2 value="2.0" type="number"/>
		            </ge>
		        </and>
	        </precondition>
	        <action>
	            <assign>
	                <assignee var="inferredUserAffect" domain="dstate"/>
					<assigner value="frustrated" />
	            </assign>
	        </action>
	    </rule>
	     <rule comment="compute the inferred affect state 2_2">
	        <precondition>
	        	<and>
	        		<equals>
					    <op1 var="fromModule" domain="dstate"/>
					    <op2 value="user" />
					</equals>
					<equals>
						<op1 var="overallSkillLevel" domain="dstate"/>
					    <op2 value="high" />
					</equals>
		            <ge>
		                <op1 var="responseIncorrectCount"  domain="dstate"/>
						<op2 value="1.0" type="number"/>
		            </ge>
		        </and>
	        </precondition>
	        <action>
	            <assign>
	                <assignee var="inferredUserAffect" domain="dstate"/>
					<assigner value="frustrated" />
	            </assign>
	        </action>
	    </rule>
	    <rule comment="compute the inferred affect state 3">
	        <precondition>
	        	<and>
	        		<equals>
					    <op1 var="responseRequired" domain="dstate"/>
					    <op2 value="true" />
					</equals>
					<ge>
		                <op1 var="currentStepTimeOutCount"  domain="dstate"/>
						<op2 value="4.0" type="number"/>
		            </ge>
		        </and>
	        </precondition>
	        <action>
	            <assign>
	                <assignee var="inferredUserAffect" domain="dstate"/>
					<assigner value="bored" />
	            </assign>
	        </action>
	    </rule>
	    <rule comment="compute the inferred affect state 4">
	        <precondition>
	        	<and>
	        		<equals>
					    <op1 var="responseRequired" domain="dstate"/>
					    <op2 value="true" />
					</equals>
					<equals>
						<op1 var="overallSkillLevel" domain="dstate"/>
					    <op2 value="high" />
					</equals>
		            <ge>
		                <op1 var="responseCorrectInARowCount"  domain="dstate"/>
						<op2 value="4.0" type="number"/>
		            </ge>
		        </and>
	        </precondition>
	        <action>
	            <assign>
	                <assignee var="inferredUserAffect" domain="dstate"/>
					<assigner value="bored" />
	            </assign>
	        </action>
	    </rule>
	    <rule comment="use inferred affect state! - never ">
	     	<precondition>
	     	    <and>
	     	        <equals>
						<op1 var="empathicTutor"  domain="dstate"/>
						<op2 value="true"/>
					</equals>
		            <equals>
		                <op1 var="useInferredAffect" domain="dstate"/>
		                <op2 value="never"/>
		            </equals>
		     	</and>
	        </precondition>
	        <action>
	            <assign>
	                <assignee var="userAffect" domain="dstate"/>
					<assigner var="sensedUserAffect" domain="dstate" />
	            </assign>
	        </action>
	     </rule>
	     <rule comment="use inferred affect state! - always">
	     	<precondition>
	     	    <and>
	     	        <equals>
						<op1 var="empathicTutor"  domain="dstate"/>
						<op2 value="true"/>
					</equals>
		            <equals>
		                <op1 var="useInferredAffect" domain="dstate"/>
		                <op2 value="always"/>
		            </equals>
		       </and>
	        </precondition>
	        <action>
	            <assign>
	                <assignee var="userAffect" domain="dstate"/>
					<assigner var="inferredUserAffect" domain="dstate" />
	            </assign>
	        </action>
	     </rule>
	     <rule comment="use inferred affect state! - combine - 1 - accept sensed affect">
	     	<precondition>
	     	    <and>
	     	        <equals>
						<op1 var="empathicTutor"  domain="dstate"/>
						<op2 value="true"/>
					</equals>
		            <equals>
		                <op1 var="useInferredAffect" domain="dstate"/>
		                <op2 value="combine"/>
		            </equals>
		            <gt>
		                <op1 var="sensedAffectConf" domain="dstate"/>
		                <op2 var="sensedAffectConfThreshold" domain="dstate"/>
		            </gt>
		        </and>
	        </precondition>
	        <action>
	            <assign>
	                <assignee var="userAffect" domain="dstate"/>
					<assigner var="sensedUserAffect" domain="dstate" />
	            </assign>
	        </action>
	     </rule>
	     <rule comment="use inferred affect state! - combine - 2 - use inferred affect">
	     	<precondition>
	     	    <and>
	     	        <equals>
						<op1 var="empathicTutor"  domain="dstate"/>
						<op2 value="true"/>
					</equals>
		            <equals>
		                <op1 var="useInferredAffect" domain="dstate"/>
		                <op2 value="combine"/>
		            </equals>
		            <le>
		                <op1 var="sensedAffectConf" domain="dstate"/>
		                <op2 value="300" type="number"/>
		            </le>
	            </and>
	        </precondition>
	        <action>
	            <assign>
	                <assignee var="userAffect" domain="dstate"/>
					<assigner var="inferredUserAffect" domain="dstate" />
	            </assign>
	        </action>
	     </rule>
	     
	     <rule comment="compute if response is required">
	        <precondition>
	        	<and>
		            <equals>
		                <op1 var="currentStepTimeOut" domain="dstate"/>
		                <op2 value="-1" type="number"/>
		            </equals>
		            <equals>
		                <op1 var="fromModule" domain="dstate"/>
		                <op2 value="stm"/>
		            </equals>
	          	</and>
	        </precondition>
	        <action>
	            <assign>
	                <assignee var="responseRequired" domain="dstate"/>
					<assigner value="true" />
	            </assign>
	        </action>
	    </rule>
	    <rule comment="user response time out?">
	        <precondition>
	        	<and>
		            <equals>
		                <op1 var="fromModule" domain="dstate"/>
		                <op2 value="hub"/>
		            </equals>
		            <equals>
		                <op1 var="utteranceStatus" domain="dstate"/>
		                <op2 value="delivered"/>
		            </equals>
	          	</and>
	        </precondition>
	        <action>
	        	<assign>
					<assignee var="responseCorrect" domain="dstate" />
					<assigner value="false" />
				</assign>
				<assign>
					<assignee var="userResponseTimedOut" domain="dstate" />
					<assigner value="true" />
				</assign>
				<assign>
				    <assignee var="currentStepTimeOutCount" domain="dstate" />
					<assigner>
							<add>
								<op1 var="currentStepTimeOutCount" domain="dstate" />
								<op2 value="1.0" />
							</add>
					</assigner>
				</assign>
				<assign>
				    <assignee var="globalStepTimeOutCount" domain="dstate" />
					<assigner>
							<add>
								<op1 var="globalStepTimeOutCount" domain="dstate" />
								<op2 value="1.0" />
							</add>
					</assigner>
				</assign>
	        </action>
	    </rule>
	     <rule id="intro_state_update_recap" comment="Intro state: RECAP not needed">
		        <precondition>
		        	<and>
			            <equals>
							<op1 var="introEpisodeState"  domain="dstate"/>
							<op2 value="recap"/>
						</equals>
						<equals>
							<op1 var="notFirstSession"  domain="dstate"/>
							<op2 value="false"/>
						</equals>
					</and>
		        </precondition>
		        <action>
			        <assign>
		                <assignee var="introEpisodeState" domain="dstate"/>
						<assigner value="taskIntro" />
	            	</assign>
		        </action>
		    </rule>
	    <rule comment="has the activity finished??">
	        <precondition>
	        	<and>
		            <equals>
						<op1 var="currentStepId"  domain="dstate"/>
						<op2 value="999"/>
					</equals>
					<equals>
						<op1 var="closingEpisodeState"  domain="dstate"/>
						<op2 value="null"/>
					</equals>
				</and>
	        </precondition>
	        <action>
	            <assign>
	                <assignee var="activityEnded" domain="dstate"/>
					<assigner value="true" />
	            </assign>
	            <assign>
	                <assignee var="closingEpisodeState" domain="dstate"/>
					<assigner value="outro" />
	            </assign>
	            <assign>
	                <assignee var="taskStatus" domain="dstate"/>
					<assigner value="closed" />
	            </assign>
	        </action>
	    </rule>
		<rule comment="Closing the task">
		    <precondition>
		        <and>
			        <equals>
						<op1 var="taskStatus"  domain="dstate"/>
						<op2 value="ongoing"/>
					</equals> 
					<equals>
					    <op1 var="systemCommunicativeFunction" domain="dstate"/>
						<op2 value="positiveFeedback" />
					</equals>
					<equals>
					    <op1 var="utteranceStatus" domain="dstate"/>
						<op2 value="delivered" />
					</equals>
				</and>
			</precondition>
		    <action>
	            <assign>
	                <assignee var="taskStatus" domain="dstate"/>
					<assigner value="closed" />
	            </assign>
	            <assign>
	                <assignee var="systemCommunicativeFunction" domain="dstate"/>
					<assigner value="null" />
	            </assign>
	         </action>
		</rule>
		<rule comment="Closing the task 2: if the task step does not require the user to respond and can just move on after TTS delivery..">
		    <precondition>
		        <and>
			        <equals>
						<op1 var="taskStatus"  domain="dstate"/>
						<op2 value="ongoing"/>
					</equals> 
					<equals>
						<op1 var="objectPlacementTask"  domain="dstate"/>
						<op2 value="false"/>
					</equals> 
					<equals>
						<op1 var="currentStepTimeOut"  domain="dstate"/>
						<op2 value="10.0" type="number"/>
					</equals> 
					<equals>
					    <op1 var="utteranceStatus" domain="dstate"/>
						<op2 value="delivered" />
					</equals>
				</and>
			</precondition>
		    <action>
	            <assign>
	                <assignee var="taskStatus" domain="dstate"/>
					<assigner value="closed" />
	            </assign>
	            <assign>
	                <assignee var="systemCommunicativeFunction" domain="dstate"/>
					<assigner value="null" />
	            </assign>
	         </action>
		</rule>
		<rule comment="Closing the task 2_1: if the op task step is done, task is set to closed after tts delivery..">
		    <precondition>
		        <and>
			        <equals>
						<op1 var="taskStatus"  domain="dstate"/>
						<op2 value="ongoing"/>
					</equals> 
					<equals>
						<op1 var="objectPlacementTask"  domain="dstate"/>
						<op2 value="true"/>
					</equals> 
					<equals>
						<op1 var="opEpisodeState"  domain="dstate"/>
						<op2 value="done"/>
					</equals> 
					<equals>
					    <op1 var="utteranceStatus" domain="dstate"/>
						<op2 value="delivered" />
					</equals>
				</and>
			</precondition>
		    <action>
	            <assign>
	                <assignee var="taskStatus" domain="dstate"/>
					<assigner value="closed" />
	            </assign>
	            <assign>
	                <assignee var="systemCommunicativeFunction" domain="dstate"/>
					<assigner value="null" />
	            </assign>
	         </action>
		</rule>
	</stateUpdateRules>
	
	<!-- ACTION SELECTION RULES -->
	<actionSelectionRules>
	    <strategy id="main">
	    	<rule id="interaction_stopped" comment="If Interaction Status is stopped, no more response!">
		        <precondition>
		            <equals>
						<op1 var="interactionStatus"  domain="dstate"/>
						<op2 value="stopped"/>
					</equals>
				</precondition>
		        <action />
		    </rule>
	        <rule id="respond_to_affect_update" comment="Affect module informs IM..IM responds!">
		        <precondition>
		            <equals>
						<op1 var="fromModule"  domain="dstate"/>
						<op2 value="affect"/>
					</equals>
				</precondition>
		        <action>
		            <!--  gotoStrategy id="affect_response_strategy"/ -->
		            <assign>
		                <assignee var="fromModule"  domain="dstate"/>
						<assigner value="null"/>
		            </assign>
		        </action>
		    </rule>
		    
	        <rule id="request_task_from_script" comment="request task">
		        <precondition>
		            <and>
		                <equals>
							<op1 var="introEpisodeState"  domain="dstate"/>
							<op2 value="done"/>
						</equals>
						<equals>
							<op1 var="taskStatus"  domain="dstate"/>
							<op2 value="closed"/>
						</equals>
						<equals>
							<op1 var="activityEnded"  domain="dstate"/>
							<op2 value="false"/>
						</equals>
						<equals>
						    <op1 var="utteranceStatus" domain="dstate"/>
							<op2 value="delivered" />
						</equals>
					</and>
				</precondition>
		        <action>
		            <assign>
		                <assignee var="toModule" domain="output"/>
						<assigner value="stm" />
		            </assign>
		            <assign>
		                <assignee var="communicativeFunction" domain="output"/>
						<assigner value="getNextStep" />
		            </assign>
		            <assign>
		                <assignee var="taskStatus" domain="dstate"/>
						<assigner value="task-requested" />
		            </assign>
		        </action>
		   </rule>
		   <rule id="activity_ended" comment="Closing activity: Activity ends here!">
		        <precondition>
		            <and>
			            <equals>
							<op1 var="activityEnded"  domain="dstate"/>
							<op2 value="true"/>
						</equals>
						<equals>
							<op1 var="closingEpisodeState"  domain="dstate"/>
							<op2 value="bye"/>
						</equals>
						<equals>
						    <op1 var="utteranceStatus" domain="dstate"/>
							<op2 value="delivered" />
						</equals>
					</and>
				</precondition>
		        <action>
		            <assign>
		                <assignee var="toModule" domain="output"/>
						<assigner value="user" />
		            </assign>
		         	<assign>
		                <assignee var="communicativeFunction" domain="output"/>
						<assigner value="goodbye" />
		            </assign>
			        <assign>
		                <assignee var="activityEnded" domain="dstate"/>
						<assigner value="closed" />
		            </assign>
		            <assign>
		                <assignee var="currentStepId" domain="dstate"/>
						<assigner value="0" />
		            </assign>
		            <assign>
						<assignee var="currentStepTimeOut" domain="dstate"/>
						<assigner value="10" type="number"/>
					</assign>
		            <assign>
		                <assignee var="time-out" domain="output"/>
						<assigner var="currentStepTimeOut" domain="dstate" />
		            </assign>
		            <assign>
		                <assignee var="utteranceStatus"  domain="dstate"/>
						<assigner value="playing"/>
		            </assign>
		        </action>
		    </rule>
		    <rule id="activity_ended_2" comment="Closing episode: Outro">
		        <precondition>
		            <and>
			            <equals>
							<op1 var="activityEnded"  domain="dstate"/>
							<op2 value="true"/>
						</equals>
						<equals>
							<op1 var="closingEpisodeState"  domain="dstate"/>
							<op2 value="outro"/>
						</equals>
						<equals>
						    <op1 var="utteranceStatus" domain="dstate"/>
							<op2 value="delivered" />
						</equals>
					</and>
				</precondition>
		        <action>
		            <assign>
		                <assignee var="toModule" domain="output"/>
						<assigner value="user" />
		            </assign>
		         	<assign>
		                <assignee var="communicativeFunction" domain="output"/>
						<assigner value="taskOutro" />
		            </assign>
		            <assign>
						<assignee var="currentStepTimeOut" domain="dstate"/>
						<assigner value="10" type="number"/>
					</assign>
					<assign>
		                <assignee var="time-out" domain="output"/>
						<assigner var="currentStepTimeOut" domain="dstate" />
		            </assign>
		            <assign>
		                <assignee var="utteranceStatus"  domain="dstate"/>
						<assigner value="playing"/>
		            </assign>
					<assign>
		                <assignee var="closingEpisodeState" domain="dstate"/>
						<assigner value="recap" />
		            </assign>
			    </action>
		    </rule>
		    <rule id="activity_ended_3" comment="Closing episode: Say GoodBye">
		        <precondition>
		            <and>
			            <equals>
							<op1 var="activityEnded"  domain="dstate"/>
							<op2 value="true"/>
						</equals>
						<equals>
							<op1 var="closingEpisodeState"  domain="dstate"/>
							<op2 value="recap"/>
						</equals>
						<equals>
						    <op1 var="utteranceStatus" domain="dstate"/>
							<op2 value="delivered" />
						</equals>
					</and>
				</precondition>
		        <action>
		            <assign>
		                <assignee var="toModule" domain="output"/>
						<assigner value="user" />
		            </assign>
		         	<assign>
		                <assignee var="communicativeFunction" domain="output"/>
						<assigner value="recap:closing" />
		            </assign>
		            <assign>
		                <assignee var="skill" domain="output"/>
						<assigner var="bestSkillSoFar" domain="dstate" />
		            </assign>
		             <assign>
						<assignee var="currentStepTimeOut" domain="dstate"/>
						<assigner value="10" type="number"/>
					</assign>
					<assign>
		                <assignee var="time-out" domain="output"/>
						<assigner var="currentStepTimeOut" domain="dstate" />
		            </assign>
		            <assign>
		                <assignee var="utteranceStatus"  domain="dstate"/>
						<assigner value="playing"/>
		            </assign>
					<assign>
		                <assignee var="closingEpisodeState" domain="dstate"/>
						<assigner value="bye" />
		            </assign>
			    </action>
		    </rule>
		   <rule id="intro_episode" comment="Intro episode">
		        <precondition>
		            <and>
			            <not-equals>
							<op1 var="introEpisodeState"  domain="dstate"/>
							<op2 value="done"/>
						</not-equals>
						<equals>
						    <op1 var="utteranceStatus" domain="dstate"/>
							<op2 value="delivered" />
						</equals>
					</and>
				</precondition>
		        <action>
		            <gotoStrategy id="intro_strategy"/>
		        </action>
		    </rule>
		    <rule id="object_placement_task" comment="Object placement task">
		        <precondition>
		            <and>
		                <not-equals>
							<op1 var="opEpisodeState"  domain="dstate"/>
							<op2 value="null"/>
						</not-equals>
						<not-equals>
							<op1 var="opEpisodeState"  domain="dstate"/>
							<op2 value="done"/>
						</not-equals>
						<!-- equals>
							<op1 var="utteranceStatus"  domain="dstate"/>
							<op2 value="delivered"/>
						</equals-->
					</and>
				</precondition>
		        <action>
		        	<gotoStrategy id="object_placement_strategy"/>
		        </action>
		    </rule>
		    <rule id="link_to_next_task" comment="link to next task">
		    	<precondition>
		        	<and>
		                <equals>
							<op1 var="taskStatus"  domain="dstate"/>
							<op2 value="task-acquired"/>
						</equals>
						<equals>
							<op1 var="objectPlacementTask"  domain="dstate"/>
							<op2 value="false"/>
						</equals>
						<equals>
							<op1 var="taskLinked"  domain="dstate"/>
							<op2 value="false"/>
						</equals>
						<equals>
							<op1 var="utteranceStatus"  domain="dstate"/>
							<op2 value="delivered"/>
						</equals>
					</and>
				</precondition>
				<actionOr>
					<action p="0.3">
			            <assign>
			                <assignee var="toModule" domain="output"/>
							<assigner value="user" />
			            </assign>
			         	<assign>
			                <assignee var="communicativeFunction" domain="output"/>
							<assigner value="linking" />
			            </assign>
			            <assign>
			                <assignee var="time-out" domain="output"/>
							<assigner value="10" />
			            </assign>
			            <assign>
			                <assignee var="utteranceStatus"  domain="dstate"/>
							<assigner value="playing"/>
			            </assign>
			            <assign>
			                <assignee var="taskLinked" domain="dstate"/>
							<assigner value="true" />
			            </assign>
			        </action>
			        <action p="0.7">
			            <assign>
			                <assignee var="toModule" domain="output"/>
							<assigner value="user" />
			            </assign>
			         	<assign>
			                <assignee var="communicativeFunction" domain="output"/>
							<assigner value="linkingSayNothing" />
			            </assign>
			            <assign>
			                <assignee var="time-out" domain="output"/>
							<assigner value="10" />
			            </assign>
			            <assign>
			                <assignee var="utteranceStatus"  domain="dstate"/>
							<assigner value="playing"/>
			            </assign>
			            <assign>
			                <assignee var="taskLinked" domain="dstate"/>
							<assigner value="true" />
			            </assign>
			        </action>
		        </actionOr>
		    </rule>
		    <rule id="present_task_1" comment="present clue speech and task to user">
		        <precondition>
		        	<and>
		                <equals>
							<op1 var="taskStatus"  domain="dstate"/>
							<op2 value="task-acquired"/>
						</equals>
						<equals>
							<op1 var="objectPlacementTask"  domain="dstate"/>
							<op2 value="false"/>
						</equals>
						<equals>
							<op1 var="clueSpeech"  domain="dstate"/>
							<op2 value="true"/>
						</equals>
						<equals>
							<op1 var="utteranceStatus"  domain="dstate"/>
							<op2 value="delivered"/>
						</equals>
					</and>
				</precondition>
				<actionAnd>
					<action>
			            <assign>
			                <assignee var="toModule" domain="output"/>
							<assigner value="user" />
			            </assign>
			         	<assign>
			                <assignee var="communicativeFunction" domain="output"/>
							<assigner value="clueSpeech" />
			            </assign>
			            <assign>
			                <assignee var="systemCommunicativeFunction" domain="dstate"/>
							<assigner value="clueSpeech" />
			            </assign>
			            <assign>
			                <assignee var="clueNumber" domain="output"/>
							<assigner var="clueNumber" domain="dstate" />
			            </assign>
			            <assign>
			                <assignee var="currentStepTimeOut" domain="dstate"/>
							<assigner value="-1.0" />
			            </assign>
			            <assign>
			                <assignee var="time-out" domain="output"/>
							<assigner var="currentStepTimeOut" domain="dstate" />
			            </assign>
			            <assign>
			                <assignee var="utteranceStatus"  domain="dstate"/>
							<assigner value="playing"/>
			            </assign>
			        </action>
			        <action>
			            <assign>
			                <assignee var="toModule" domain="output"/>
							<assigner value="user" />
			            </assign>
			         	<assign>
			                <assignee var="communicativeFunction" domain="output"/>
							<assigner value="presentTask" />
			            </assign>
			            <assign>
			                <assignee var="learnerName" domain="output"/>
							<assigner var="learnerName" domain="dstate" />
			            </assign>
			            <assign>
			                <assignee var="currentStepId" domain="output"/>
							<assigner var="currentStepId" domain="dstate" />
			            </assign>
			            <assign>
			                <assignee var="time-out" domain="output"/>
							<assigner var="currentStepTimeOut" domain="dstate" />
			            </assign>
			            <assign>
							<assignee var="directionSkillRequired" domain="output" />
							<assigner var="directionSkillRequired" domain="dstate" />
						</assign>
						<assign>
							<assignee var="distanceSkillRequired" domain="output" />
							<assigner var="distanceSkillRequired" domain="dstate" />
						</assign>
						<assign>
							<assignee var="symbolSkillRequired" domain="output"/>
							<assigner var="symbolSkillRequired" domain="dstate" />
						</assign>
						<assign>
							<assignee var="toolSkillRequired" domain="output"/>
							<assigner var="toolSkillRequired" domain="dstate" />
						</assign>
						<assign>
							<assignee var="correctDirection" domain="output"/>
							<assigner var="correctDirection" domain="dstate" />
						</assign>
						<assign>
							<assignee var="correctDistance" domain="output"/>
							<assigner var="correctDistance" domain="dstate" />
						</assign>
						<assign>
							<assignee var="correctSymbol" domain="output"/>
							<assigner var="correctSymbol" domain="dstate" />
						</assign>
						<assign>
							<assignee var="correctTool" domain="output"/>
							<assigner var="correctTool" domain="dstate" />
						</assign>
			            <assign>
			                <assignee var="taskStatus" domain="dstate" />
			                <assigner value="ongoing" />
			            </assign>
			            <assign>
			                <assignee var="utterance" domain="output"/>
							<assigner var="currentStepSpeech" domain="dstate" />
			            </assign>
			            <assign>
			                <assignee var="utteranceStatus" domain="dstate" />
			                <assigner value="sent-to-tts" />
			            </assign>
			            <assign>
			            	<assignee var="inferredUserAffect" domain="dstate"/>
							<assigner value="neutral" />
	            		</assign>
	            		<assign>
			            	<assignee var="userAffect" domain="dstate"/>
							<assigner value="neutral" />
	            		</assign>
			            <assign>
						    <assignee var="currentStepAnswerAttemptCount" domain="dstate" />
							<assigner value="0"/> 
						</assign>
						<assign>
						    <assignee var="responseIncorrectCount" domain="dstate" />
							<assigner value="0"/> 
						</assign>
						<assign>
						    <assignee var="currentStepTimeOutCount" domain="dstate" />
							<assigner value="0"/> 
						</assign>
						<assign>
						    <assignee var="globalStepTimeOutCount" domain="dstate" />
							<assigner value="0"/> 
						</assign>
						<assign>
						    <assignee var="dirToolUsed" domain="dstate" />
							<assigner value="false"/> 
						</assign>
						<assign>
						    <assignee var="disToolUsed" domain="dstate" />
							<assigner value="false"/> 
						</assign>
						<assign>
						    <assignee var="symToolUsed" domain="dstate" />
							<assigner value="false"/> 
						</assign>
						<assign>
							<assignee var="clueSpeech" domain="dstate" />
							<assigner var="infoOnCompletion" domain="dstate"/> 
						</assign>
			        </action>
		        </actionAnd>
		    </rule>
		   <rule id="present_task_2" comment="present task to user">
		        <precondition>
		        	<and>
		                <equals>
							<op1 var="taskStatus"  domain="dstate"/>
							<op2 value="task-acquired"/>
						</equals>
						<equals>
							<op1 var="objectPlacementTask"  domain="dstate"/>
							<op2 value="false"/>
						</equals>
						<equals>
							<op1 var="utteranceStatus"  domain="dstate"/>
							<op2 value="delivered"/>
						</equals>
					</and>
				</precondition>
				<actionAnd>
					
			        <action>
			            <assign>
			                <assignee var="toModule" domain="output"/>
							<assigner value="user" />
			            </assign>
			         	<assign>
			                <assignee var="communicativeFunction" domain="output"/>
							<assigner value="presentTask" />
			            </assign>
			            <assign>
			                <assignee var="learnerName" domain="output"/>
							<assigner var="learnerName" domain="dstate" />
			            </assign>
			            <assign>
			                <assignee var="currentStepId" domain="output"/>
							<assigner var="currentStepId" domain="dstate" />
			            </assign>
			            <assign>
			                <assignee var="time-out" domain="output"/>
							<assigner var="currentStepTimeOut" domain="dstate" />
			            </assign>
			            <assign>
							<assignee var="directionSkillRequired" domain="output" />
							<assigner var="directionSkillRequired" domain="dstate" />
						</assign>
						<assign>
							<assignee var="distanceSkillRequired" domain="output" />
							<assigner var="distanceSkillRequired" domain="dstate" />
						</assign>
						<assign>
							<assignee var="symbolSkillRequired" domain="output"/>
							<assigner var="symbolSkillRequired" domain="dstate" />
						</assign>
						<assign>
							<assignee var="toolSkillRequired" domain="output"/>
							<assigner var="toolSkillRequired" domain="dstate" />
						</assign>
						<assign>
							<assignee var="correctDirection" domain="output"/>
							<assigner var="correctDirection" domain="dstate" />
						</assign>
						<assign>
							<assignee var="correctDistance" domain="output"/>
							<assigner var="correctDistance" domain="dstate" />
						</assign>
						<assign>
							<assignee var="correctSymbol" domain="output"/>
							<assigner var="correctSymbol" domain="dstate" />
						</assign>
						<assign>
							<assignee var="correctTool" domain="output"/>
							<assigner var="correctTool" domain="dstate" />
						</assign>
			            <assign>
			                <assignee var="taskStatus" domain="dstate" />
			                <assigner value="ongoing" />
			            </assign>
			            <assign>
			                <assignee var="utterance" domain="output"/>
							<assigner var="currentStepSpeech" domain="dstate" />
			            </assign>
			            <assign>
			                <assignee var="utteranceStatus" domain="dstate" />
			                <assigner value="sent-to-tts" />
			            </assign>
			            <assign>
						    <assignee var="currentStepAnswerAttemptCount" domain="dstate" />
							<assigner value="0"/> 
						</assign>
						<assign>
						    <assignee var="responseIncorrectCount" domain="dstate" />
							<assigner value="0"/> 
						</assign>
						<assign>
	                		<assignee var="inferredUserAffect" domain="dstate"/>
							<assigner value="neutral" />
	            		</assign>
	            		<assign>
			            	<assignee var="userAffect" domain="dstate"/>
							<assigner value="neutral" />
	            		</assign>
						<assign>
						    <assignee var="currentStepTimeOutCount" domain="dstate" />
							<assigner value="0"/> 
						</assign>
						<assign>
						    <assignee var="globalStepTimeOutCount" domain="dstate" />
							<assigner value="0"/> 
						</assign>
						<assign>
						    <assignee var="dirToolUsed" domain="dstate" />
							<assigner value="false"/> 
						</assign>
						<assign>
						    <assignee var="disToolUsed" domain="dstate" />
							<assigner value="false"/> 
						</assign>
						<assign>
						    <assignee var="symToolUsed" domain="dstate" />
							<assigner value="false"/> 
						</assign>
						<assign>
							<assignee var="clueSpeech" domain="dstate" />
							<assigner var="infoOnCompletion" domain="dstate"/> 
						</assign>
			        </action>
		        </actionAnd>
		    </rule>
		    <rule id="respond_to_answerAttempts" comment="User tries to answer.. IM responds!">
		        <precondition>
		            <and>
			            <equals>
							<op1 var="fromModule"  domain="dstate"/>
							<op2 value="user"/>
						</equals>
						<equals>
							<op1 var="responseRequired"  domain="dstate"/>
							<op2 value="true"/>
						</equals>
						<equals>
							<op1 var="objectPlacementTask"  domain="dstate"/>
							<op2 value="false"/>
						</equals>
					</and>
				</precondition>
		        <action>
		        	<gotoStrategy id="answerAttempt_response_strategy"/>
		        </action>
		    </rule>
		    
		    
		    <rule id="respond_to_tts" comment="UtteranceStatus playing..IM responds with nothing!">
		        <precondition>
		            <equals>
						<op1 var="utteranceStatus"  domain="dstate"/>
						<op2 value="playing"/>
					</equals>
		        </precondition>
		        <action/>
		    </rule>
		    <rule id="respond_to_tts2" comment="Utterance is delivered..IM needs to wait for user input!">
		        <precondition>
		            <and>
		                <equals>
							<op1 var="fromModule"  domain="dstate"/>
							<op2 value="tts"/>
						</equals>
			            <equals>
							<op1 var="utteranceStatus"  domain="dstate"/>
							<op2 value="delivered"/>
						</equals>
						<equals>
							<op1 var="currentStepTimeOut"  domain="dstate"/>
							<op2 value="-1" type="number"/>
						</equals>
					</and>
		        </precondition>
		        <action/>
		    </rule>
		    
		    
		   <rule id="respond_to_timeout" comment="Hub informs IM of a timeOut..IM responds!">
		        <precondition>
		            <and>
			            <equals>
							<op1 var="userResponseTimedOut"  domain="dstate"/>
							<op2 value="true"/>
						</equals>
						<equals>
							<op1 var="responseRequired"  domain="dstate"/>
							<op2 value="true"/>
						</equals>
					</and>
				</precondition>
		        <action>
		            <assign>
		                <assignee var="userResponseTimedOut" domain="dstate"/>
						<assigner value="false" />
	           		</assign>
		            <gotoStrategy id="timeout_response_strategy"/>
		        </action>
		    </rule>
		    
		    <rule id="mail-last" comment="do nothing">
		        <precondition/>
		        <action/>
    	    </rule>
		</strategy>
	    <strategy id="intro_strategy" source="scripts/scenario1emote4_intro_strategy.xml" />
	    <strategy id="object_placement_strategy" source="scripts/scenario1emote4_object_placement_strategy.xml" />
	    <strategy id="affect_response_strategy" source="scripts/scenario1emote4_affect_input_response_strategy.xml" />
	    <strategy id="timeout_response_strategy" source="scripts/scenario1emote4_timeout_response_strategy.xml" />
	    <strategy id="answerAttempt_response_strategy" source="scripts/scenario1emote4_answerAttempt_response_strategy.xml" />
	    <strategy id="social_bonding_strategy" source="scripts/scenario1emote4_social_bonding_strategy.xml" />
	    <strategy id="pedagogical_strategy_for_bored" source="scripts/scenario1emote4_pedagogical_strategy_for_bored.xml" />
	    <strategy id="pedagogical_strategy_for_frustrated" source="scripts/scenario1emote4_pedagogical_strategy_for_frustrated.xml" />
	    <strategy id="incorrect_tool_strategy_for_frustrated" source="scripts/scenario1emote4_incorrect_tool_strategy_for_frustrated.xml" />
	    <strategy id="incorrect_sym_strategy_for_frustrated" source="scripts/scenario1emote4_incorrect_sym_strategy_for_frustrated.xml" />
	    <strategy id="incorrect_dir_strategy_for_frustrated" source="scripts/scenario1emote4_incorrect_dir_strategy_for_frustrated.xml" />
	    <strategy id="incorrect_dis_strategy_for_frustrated" source="scripts/scenario1emote4_incorrect_dis_strategy_for_frustrated.xml" />
	    <strategy id="pedagogical_strategy_for_neutral_users" source="scripts/scenario1emote4_pedagogical_strategy_for_neutral_users.xml" />
	    <strategy id="pedagogical_strategy_for_happy_users" source="scripts/scenario1emote4_pedagogical_strategy_for_happy_users.xml" />
	    <strategy id="pedagogical_strategy_for_calm_users" source="scripts/scenario1emote4_pedagogical_strategy_for_calm_users.xml" />
	    <strategy id="incorrect_tool_strategy_for_others" source="scripts/scenario1emote4_incorrect_tool_strategy_for_others.xml" />
	    <strategy id="incorrect_sym_strategy_for_others" source="scripts/scenario1emote4_incorrect_sym_strategy_for_others.xml" />
	    <strategy id="incorrect_dir_strategy_for_others" source="scripts/scenario1emote4_incorrect_dir_strategy_for_others.xml" />
	    <strategy id="incorrect_dis_strategy_for_others" source="scripts/scenario1emote4_incorrect_dis_strategy_for_others.xml" />
	    <strategy id="pedagogical_strategy_for_frustrated_timeout" source="scripts/scenario1emote4_pedagogical_strategy_for_frustrated_timeout.xml" />
	    <strategy id="incorrect_tool_strategy_for_frustrated_timeout" source="scripts/scenario1emote4_incorrect_tool_strategy_for_frustrated_timeout.xml" />
	    <strategy id="incorrect_sym_strategy_for_frustrated_timeout" source="scripts/scenario1emote4_incorrect_sym_strategy_for_frustrated_timeout.xml" />
	    <strategy id="incorrect_dir_strategy_for_frustrated_timeout" source="scripts/scenario1emote4_incorrect_dir_strategy_for_frustrated_timeout.xml" />
	    <strategy id="incorrect_dis_strategy_for_frustrated_timeout" source="scripts/scenario1emote4_incorrect_dis_strategy_for_frustrated_timeout.xml" />
	    <strategy id="pedagogical_strategy_for_other_users_timeout" source="scripts/scenario1emote4_pedagogical_strategy_for_other_users_timeout.xml" />
	    <strategy id="incorrect_tool_strategy_for_others_timeout" source="scripts/scenario1emote4_incorrect_tool_strategy_for_others_timeout.xml" />
	    <strategy id="incorrect_sym_strategy_for_others_timeout" source="scripts/scenario1emote4_incorrect_sym_strategy_for_others_timeout.xml" />
	    <strategy id="incorrect_dir_strategy_for_others_timeout" source="scripts/scenario1emote4_incorrect_dir_strategy_for_others_timeout.xml" />
	    <strategy id="incorrect_dis_strategy_for_others_timeout" source="scripts/scenario1emote4_incorrect_dis_strategy_for_others_timeout.xml" />
	    <strategy id="performance_feedback_happy_users" source="scripts/scenario1emote4_performance_feedback_happy_users.xml" />
	    <strategy id="performance_feedback_calm_users" source="scripts/scenario1emote4_performance_feedback_calm_users.xml" />
	    <strategy id="performance_feedback_bored_users" source="scripts/scenario1emote4_performance_feedback_bored_users.xml" />
	    <strategy id="performance_feedback_frustrated_users" source="scripts/scenario1emote4_performance_feedback_frustrated_users.xml" />
	</actionSelectionRules>
</dialogueScript>